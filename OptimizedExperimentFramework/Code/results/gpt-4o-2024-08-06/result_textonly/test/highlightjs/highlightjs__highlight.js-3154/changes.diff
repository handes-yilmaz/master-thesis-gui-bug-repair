diff --git a/src/languages/ruby.js b/src/languages/ruby.js
index e6ea0b76a..bc91820bd 100644
--- a/src/languages/ruby.js
+++ b/src/languages/ruby.js
@@ -124,23 +124,24 @@ export default function(hljs) {
       {
         begin: /\B\?\\?\S/
       },
-      { // heredocs
-        begin: /<<[-~]?'?(\w+)\n(?:[^\n]*\n)*?\s*\1\b/,
-        returnBegin: true,
-        contains: [
-          {
-            begin: /<<[-~]?'?/
-          },
-          hljs.END_SAME_AS_BEGIN({
-            begin: /(\w+)/,
-            end: /(\w+)/,
-            contains: [
-              hljs.BACKSLASH_ESCAPE,
-              SUBST
-            ]
-          })
-        ]
-      }
+{ // heredocs
+begin: /<<[-~]?\'?(\\w+)\\n(?:[^\\n]*\\n)*?\\s*\\1\\b/,
+returnBegin: true,
+contains: [
+{
+begin: /<<[-~]?\'?/
+},
+hljs.END_SAME_AS_BEGIN({
+begin: /(\\w+)/,
+end: /(\\w+)/,
+contains: [
+hljs.BACKSLASH_ESCAPE,
+SUBST
+],
+endsWithParent: true
+})
+]
+}
     ]
   };
 
